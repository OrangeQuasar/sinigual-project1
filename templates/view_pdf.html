{% extends "base.html" %}

{% block content %}
<div class="pdf-view-container">
    <div class="pdf-viewer-main">
        <h2>{{ pdf.title }}</h2>
        <p>æŠ•ç¨¿è€…: {{ pdf.username }}</p>
        <div class="pdf-viewer-controls">
            <button id="prev-page">ï¼œ å‰ã¸</button>
            <span id="page-info"></span>
            <button id="next-page">æ¬¡ã¸ ï¼</button>
        </div>
        <canvas id="pdf-canvas"></canvas>
    </div>
    <div class="pdf-sidebar">
        <h3>ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
        <div class="reactions-container">
            <div class="reactions">
                {% for reaction in pdf.reactions %}
                <span class="reaction-emoji {% if reaction.emoji in pdf.user_reactions %}user-reacted{% endif %}"
                      data-pdf-id="{{ pdf.id }}" data-emoji="{{ reaction.emoji }}">
                    {{ reaction.emoji }} <span class="reaction-count">{{ reaction.count }}</span>
                </span>
                {% endfor %}
            </div>
            <div class="add-reaction">
                <button class="add-reaction-btn">+</button>
                <div class="emoji-picker">
                    <span data-pdf-id="{{ pdf.id }}" data-emoji="ğŸ‘">ğŸ‘</span>
                    <span data-pdf-id="{{ pdf.id }}" data-emoji="â¤ï¸">â¤ï¸</span>
                    <span data-pdf-id="{{ pdf.id }}" data-emoji="ğŸ˜‚">ğŸ˜‚</span>
                    <span data-pdf-id="{{ pdf.id }}" data-emoji="ğŸ‰">ğŸ‰</span>
                </div>
            </div>
        </div>
        <hr>
        <h3>å…±æœ‰</h3>
        <button id="share-btn">ã“ã®ãƒšãƒ¼ã‚¸ã®URLã‚’ã‚³ãƒ”ãƒ¼</button>
        <hr>
        <h3>ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
        <div class="comment-section">
            <form action="{{ url_for('add_comment', pdf_id=pdf.id) }}" method="post">
                <textarea name="content" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ..." required></textarea>
                <button type="submit">æŠ•ç¨¿</button>
            </form>
            <div class="comment-list">
                {% for comment in comments recursive %}
                <div class="comment" id="comment-{{ comment.id }}">
                    <p><strong>{{ comment.username }}</strong> <small>{{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
                    <p>{{ comment.content | nl2br }}</p>
                    <a href="#" class="reply-btn" data-comment-id="{{ comment.id }}">è¿”ä¿¡ã™ã‚‹</a>
                    {% if comment.replies %}
                        <div class="replies">
                            {{ loop(comment.replies) }}
                        </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div id="reply-form-template" style="display: none;">
    <form action="{{ url_for('add_comment', pdf_id=pdf.id) }}" method="post" class="reply-form">
        <input type="hidden" name="parent_id" value="">
        <textarea name="content" placeholder="è¿”ä¿¡ã‚’è¿½åŠ ..." required></textarea>
        <button type="submit">è¿”ä¿¡</button>
        <button type="button" class="cancel-reply-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script type="module">
    // ( ... PDF.js ã®èª­ã¿è¾¼ã¿ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€å…±æœ‰ã€ã‚³ãƒ¡ãƒ³ãƒˆè¿”ä¿¡ã®JavaScriptã‚³ãƒ¼ãƒ‰ã¯å‰ã®å›ç­”ã¨åŒã˜ã§ã™ ... )
</script>
{% endblock %}